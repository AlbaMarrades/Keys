import { NgModule } from '@angular/core';
import { FakeMissingTranslationHandler, TranslateDefaultParser, TranslateFakeCompiler, TranslateModule, TranslateService } from '@ngx-translate/core';
import { TestTranslateLoader } from './test-translate-loader.service';
import * as i0 from "@angular/core";
/**
 * The TranslateTestingModule provides the {TranslateModule} as well as a
 * {TranslateService} configured to return translations specific for the
 * test environment.
 *
 * @export
 */
export class TranslateTestingModule {
    constructor() {
        this._translations = {};
    }
    static withTranslations(languageOrTranslations, translations) {
        const translateTestingModule = new TranslateTestingModule();
        if (typeof languageOrTranslations === 'string') {
            return translateTestingModule.withTranslations(languageOrTranslations, translations);
        }
        return translateTestingModule.withTranslations(languageOrTranslations);
    }
    get ngModule() {
        return TranslateTestingModule;
    }
    get providers() {
        const translateService = new TranslateService(null, new TestTranslateLoader(this._translations), this._compiler || new TranslateFakeCompiler(), new TranslateDefaultParser(), new FakeMissingTranslationHandler(), true, true, false, this._defaultLanguage);
        return [
            {
                provide: TranslateService,
                useValue: translateService
            }
        ];
    }
    withTranslations(languageOrTranslations, translations) {
        if (typeof languageOrTranslations === 'string' && translations) {
            this.addTranslations(languageOrTranslations, translations);
            this._defaultLanguage = languageOrTranslations;
        }
        else if (languageOrTranslations) {
            Object.keys(languageOrTranslations).forEach(language => this.addTranslations(language, languageOrTranslations[language]));
        }
        return this;
    }
    /**
     * Updates the {TranslationTestingModule} to provide a {TranslateService} that will
     * use the provided {TranslateCompiler} to translate the test translations.
     *
     * @example
     *
     * TranslateTestingModule.withTranslations('en', {people: '{gender, select, male{He is} female{She is} other{They are}} {how})'})
     *   .withCompiler(new TranslateMessageFormatCompiler());
     *
     * @param compiler the compiler to use to compile the test translations.
     * @returns the instance that can be used to chain additional configuration.
     * @memberof TranslateTestingModule
     */
    withCompiler(compiler) {
        this._compiler = compiler;
        return this;
    }
    /**
     * Updates the {TranslateTestingModule} to use the provided language as the default language.
     * By default, the default language will be set to the first language provided.
     *
     * @example
     *
     * TranslateTestingModule.withTranslations('es', SPANISH_TRANSLATIONS)
     *   .withTranslations('en', ENGLISH_TRANSLATIONS)
     *   .withDefaultLanguage('en');
     *
     * @param language the new default language for translations.
     * @returns the instance that can be used to chain additional configuration.
     * @memberof TranslateTestingModule
     */
    withDefaultLanguage(language) {
        this._defaultLanguage = language || this._defaultLanguage;
        return this;
    }
    addTranslations(language, translations) {
        if (!this._defaultLanguage) {
            this._defaultLanguage = language;
        }
        if (this._translations[language]) {
            this._translations[language] = {
                ...this._translations[language],
                ...translations
            };
        }
        else {
            this._translations[language] = translations;
        }
    }
}
/** @nocollapse */ /** @nocollapse */ TranslateTestingModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: TranslateTestingModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });
/** @nocollapse */ /** @nocollapse */ TranslateTestingModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: TranslateTestingModule, imports: [TranslateModule], exports: [TranslateModule] });
/** @nocollapse */ /** @nocollapse */ TranslateTestingModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: TranslateTestingModule, imports: [[TranslateModule], TranslateModule] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: TranslateTestingModule, decorators: [{
            type: NgModule,
            args: [{
                    imports: [TranslateModule],
                    exports: [TranslateModule]
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdGluZy5tb2R1bGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy90ZXN0aW5nL3NyYy9saWIvdGVzdGluZy5tb2R1bGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUF1QixRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFOUQsT0FBTyxFQUNMLDZCQUE2QixFQUM3QixzQkFBc0IsRUFDdEIscUJBQXFCLEVBQ3JCLGVBQWUsRUFDZixnQkFBZ0IsRUFFakIsTUFBTSxxQkFBcUIsQ0FBQztBQUU3QixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7QUFHdEU7Ozs7OztHQU1HO0FBS0gsTUFBTSxPQUFPLHNCQUFzQjtJQUpuQztRQUtVLGtCQUFhLEdBQWlCLEVBQUUsQ0FBQztLQW1NMUM7SUFuSlEsTUFBTSxDQUFDLGdCQUFnQixDQUM1QixzQkFBNkMsRUFDN0MsWUFBbUM7UUFFbkMsTUFBTSxzQkFBc0IsR0FBRyxJQUFJLHNCQUFzQixFQUFFLENBQUM7UUFFNUQsSUFBSSxPQUFPLHNCQUFzQixLQUFLLFFBQVEsRUFBRTtZQUM5QyxPQUFPLHNCQUFzQixDQUFDLGdCQUFnQixDQUFTLHNCQUFzQixFQUFFLFlBQVksQ0FBQyxDQUFDO1NBQzlGO1FBRUQsT0FBTyxzQkFBc0IsQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRCxJQUFXLFFBQVE7UUFDakIsT0FBTyxzQkFBc0IsQ0FBQztJQUNoQyxDQUFDO0lBRUQsSUFBVyxTQUFTO1FBQ2xCLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxnQkFBZ0IsQ0FDM0MsSUFBSSxFQUNKLElBQUksbUJBQW1CLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUMzQyxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUkscUJBQXFCLEVBQUUsRUFDN0MsSUFBSSxzQkFBc0IsRUFBRSxFQUM1QixJQUFJLDZCQUE2QixFQUFFLEVBQ25DLElBQUksRUFDSixJQUFJLEVBQ0osS0FBSyxFQUNMLElBQUksQ0FBQyxnQkFBZ0IsQ0FDdEIsQ0FBQztRQUVGLE9BQU87WUFDTDtnQkFDRSxPQUFPLEVBQUUsZ0JBQWdCO2dCQUN6QixRQUFRLEVBQUUsZ0JBQWdCO2FBQzNCO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUE2Q00sZ0JBQWdCLENBQ3JCLHNCQUE2QyxFQUM3QyxZQUFtQztRQUVuQyxJQUFJLE9BQU8sc0JBQXNCLEtBQUssUUFBUSxJQUFJLFlBQVksRUFBRTtZQUM5RCxJQUFJLENBQUMsZUFBZSxDQUFDLHNCQUFzQixFQUFFLFlBQVksQ0FBQyxDQUFDO1lBQzNELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxzQkFBc0IsQ0FBQztTQUNoRDthQUFNLElBQUksc0JBQXNCLEVBQUU7WUFDakMsTUFBTSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUNyRCxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxzQkFBc0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUNqRSxDQUFDO1NBQ0g7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7O09BWUc7SUFDSSxZQUFZLENBQUMsUUFBMkI7UUFDN0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7UUFDMUIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7T0FhRztJQUNJLG1CQUFtQixDQUFDLFFBQWdCO1FBQ3pDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxRQUFRLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDO1FBQzFELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVPLGVBQWUsQ0FBQyxRQUFnQixFQUFFLFlBQWtDO1FBQzFFLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLFFBQVEsQ0FBQztTQUNsQztRQUVELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNoQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxHQUFHO2dCQUM3QixHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDO2dCQUMvQixHQUFHLFlBQVk7YUFDaEIsQ0FBQztTQUNIO2FBQU07WUFDTCxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxHQUFHLFlBQVksQ0FBQztTQUM3QztJQUNILENBQUM7O3lKQW5NVSxzQkFBc0I7MEpBQXRCLHNCQUFzQixZQUh2QixlQUFlLGFBQ2YsZUFBZTswSkFFZCxzQkFBc0IsWUFIeEIsQ0FBQyxlQUFlLENBQUMsRUFDaEIsZUFBZTsyRkFFZCxzQkFBc0I7a0JBSmxDLFFBQVE7bUJBQUM7b0JBQ1IsT0FBTyxFQUFFLENBQUMsZUFBZSxDQUFDO29CQUMxQixPQUFPLEVBQUUsQ0FBQyxlQUFlLENBQUM7aUJBQzNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9kdWxlV2l0aFByb3ZpZGVycywgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7XHJcbiAgRmFrZU1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXIsXHJcbiAgVHJhbnNsYXRlRGVmYXVsdFBhcnNlcixcclxuICBUcmFuc2xhdGVGYWtlQ29tcGlsZXIsXHJcbiAgVHJhbnNsYXRlTW9kdWxlLFxyXG4gIFRyYW5zbGF0ZVNlcnZpY2UsXHJcbiAgVHJhbnNsYXRlQ29tcGlsZXJcclxufSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcclxuXHJcbmltcG9ydCB7IFRlc3RUcmFuc2xhdGVMb2FkZXIgfSBmcm9tICcuL3Rlc3QtdHJhbnNsYXRlLWxvYWRlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTGFuZ3VhZ2VUcmFuc2xhdGlvbnMsIFRyYW5zbGF0aW9ucyB9IGZyb20gJy4vdHJhbnNsYXRpb25zLm1vZGVsJztcclxuXHJcbi8qKlxyXG4gKiBUaGUgVHJhbnNsYXRlVGVzdGluZ01vZHVsZSBwcm92aWRlcyB0aGUge1RyYW5zbGF0ZU1vZHVsZX0gYXMgd2VsbCBhcyBhXHJcbiAqIHtUcmFuc2xhdGVTZXJ2aWNlfSBjb25maWd1cmVkIHRvIHJldHVybiB0cmFuc2xhdGlvbnMgc3BlY2lmaWMgZm9yIHRoZVxyXG4gKiB0ZXN0IGVudmlyb25tZW50LlxyXG4gKlxyXG4gKiBAZXhwb3J0XHJcbiAqL1xyXG5ATmdNb2R1bGUoe1xyXG4gIGltcG9ydHM6IFtUcmFuc2xhdGVNb2R1bGVdLFxyXG4gIGV4cG9ydHM6IFtUcmFuc2xhdGVNb2R1bGVdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBUcmFuc2xhdGVUZXN0aW5nTW9kdWxlIGltcGxlbWVudHMgTW9kdWxlV2l0aFByb3ZpZGVyczxUcmFuc2xhdGVUZXN0aW5nTW9kdWxlPiB7XHJcbiAgcHJpdmF0ZSBfdHJhbnNsYXRpb25zOiBUcmFuc2xhdGlvbnMgPSB7fTtcclxuXHJcbiAgcHJpdmF0ZSBfZGVmYXVsdExhbmd1YWdlOiBzdHJpbmc7XHJcblxyXG4gIHByaXZhdGUgX2NvbXBpbGVyOiBUcmFuc2xhdGVDb21waWxlcjtcclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUge1RyYW5zbGF0ZVRlc3RpbmdNb2R1bGV9IHdpdGggdHJhbnNsYXRpb25zIGZvciB0aGUgc3BlY2lmaWVkIGxhbmd1YWdlLlxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKlxyXG4gICAqIGNvbnN0IEVOR0xJU0hfVFJBTlNMQVRJT05TID0geyBncmVldGluZzogJ0hlbGxvJyB9O1xyXG4gICAqIGNvbnN0IHRyYW5zbGF0ZU1vZHVsZSA9IFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUud2l0aFRyYW5zbGF0aW9ucygnZW4nLCBFTkdMSVNIX1RSQU5TTEFUSU9OUyk7XHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqXHJcbiAgICogVHJhbnNsYXRlVGVzdGluZ01vZHVsZS53aXRoVHJhbnNsYXRpb25zKCdlbicsIHJlcXVpcmUoJy4uLy4uL2Fzc2V0cy9pMThuL2VuLmpzb24nKSk7XHJcbiAgICpcclxuICAgKiBAc3RhdGljXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIHRoZSBsYW5ndWFnZSBmb3IgdGhlIHRyYW5zbGF0aW9ucy5cclxuICAgKiBAcGFyYW0ge1RyYW5zbGF0aW9uc30gdHJhbnNsYXRpb25zIHRoZSB0cmFuc2xhdGlvbnMgdG8gYmUgdXNlZCBpbiB0aGUgdGVzdHMuXHJcbiAgICogQHJldHVybnMgdGhlIG5ldyBpbnN0YW5jZSB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoYWluIGFkZGl0aW9uYWwgY29uZmlndXJhdGlvbi5cclxuICAgKiBAbWVtYmVyb2YgVHJhbnNsYXRlVGVzdGluZ01vZHVsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgd2l0aFRyYW5zbGF0aW9ucyhcclxuICAgIGxhbmd1YWdlOiBzdHJpbmcsXHJcbiAgICB0cmFuc2xhdGlvbnM6IExhbmd1YWdlVHJhbnNsYXRpb25zXHJcbiAgKTogVHJhbnNsYXRlVGVzdGluZ01vZHVsZTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUge1RyYW5zbGF0ZVRlc3RpbmdNb2R1bGV9IHdpdGggdGhlIHByb3ZpZGVkIHRyYW5zbGF0aW9ucy5cclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICpcclxuICAgKiBjb25zdCBUUkFOU0xBVElPTlMgPSB7IGVuOiB7IGdyZWV0aW5nOiAnSGVsbG8nIH0sIGVzOiB7IGdyZWV0aW5nOiAnSG9sYScgfSB9O1xyXG4gICAqIGNvbnN0IHRyYW5zbGF0ZU1vZHVsZSA9IFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUud2l0aFRyYW5zbGF0aW9ucyhUUkFOU0xBVElPTlMpO1xyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKlxyXG4gICAqIFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUud2l0aFRyYW5zbGF0aW9ucyhyZXF1aXJlKCcuL3Rlc3QuaTE4bi5qc29uJykpO1xyXG4gICAqXHJcbiAgICogQHN0YXRpY1xyXG4gICAqIEBwYXJhbSB7VHJhbnNsYXRpb25zfSB0aGUgbGFuZ3VhZ2UgdHJhbnNsYXRpb25zIHRoZSB0cmFuc2xhdGlvbnMgdG8gYmUgdXNlZCBpbiB0aGUgdGVzdHMuXHJcbiAgICogQHJldHVybnMgdGhlIG5ldyBpbnN0YW5jZSB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoYWluIGFkZGl0aW9uYWwgY29uZmlndXJhdGlvbi5cclxuICAgKiBAbWVtYmVyb2YgVHJhbnNsYXRlVGVzdGluZ01vZHVsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgd2l0aFRyYW5zbGF0aW9ucyh0cmFuc2xhdGlvbnM6IFRyYW5zbGF0aW9ucyk6IFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGU7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgd2l0aFRyYW5zbGF0aW9ucyhcclxuICAgIGxhbmd1YWdlT3JUcmFuc2xhdGlvbnM6IHN0cmluZyB8IFRyYW5zbGF0aW9ucyxcclxuICAgIHRyYW5zbGF0aW9ucz86IExhbmd1YWdlVHJhbnNsYXRpb25zXHJcbiAgKTogVHJhbnNsYXRlVGVzdGluZ01vZHVsZSB7XHJcbiAgICBjb25zdCB0cmFuc2xhdGVUZXN0aW5nTW9kdWxlID0gbmV3IFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUoKTtcclxuXHJcbiAgICBpZiAodHlwZW9mIGxhbmd1YWdlT3JUcmFuc2xhdGlvbnMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHJldHVybiB0cmFuc2xhdGVUZXN0aW5nTW9kdWxlLndpdGhUcmFuc2xhdGlvbnMoPHN0cmluZz5sYW5ndWFnZU9yVHJhbnNsYXRpb25zLCB0cmFuc2xhdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0cmFuc2xhdGVUZXN0aW5nTW9kdWxlLndpdGhUcmFuc2xhdGlvbnMobGFuZ3VhZ2VPclRyYW5zbGF0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG5nTW9kdWxlKCkge1xyXG4gICAgcmV0dXJuIFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHByb3ZpZGVycygpIHtcclxuICAgIGNvbnN0IHRyYW5zbGF0ZVNlcnZpY2UgPSBuZXcgVHJhbnNsYXRlU2VydmljZShcclxuICAgICAgbnVsbCxcclxuICAgICAgbmV3IFRlc3RUcmFuc2xhdGVMb2FkZXIodGhpcy5fdHJhbnNsYXRpb25zKSxcclxuICAgICAgdGhpcy5fY29tcGlsZXIgfHwgbmV3IFRyYW5zbGF0ZUZha2VDb21waWxlcigpLFxyXG4gICAgICBuZXcgVHJhbnNsYXRlRGVmYXVsdFBhcnNlcigpLFxyXG4gICAgICBuZXcgRmFrZU1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXIoKSxcclxuICAgICAgdHJ1ZSxcclxuICAgICAgdHJ1ZSxcclxuICAgICAgZmFsc2UsXHJcbiAgICAgIHRoaXMuX2RlZmF1bHRMYW5ndWFnZVxyXG4gICAgKTtcclxuXHJcbiAgICByZXR1cm4gW1xyXG4gICAgICB7XHJcbiAgICAgICAgcHJvdmlkZTogVHJhbnNsYXRlU2VydmljZSxcclxuICAgICAgICB1c2VWYWx1ZTogdHJhbnNsYXRlU2VydmljZVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGUge1RyYW5zbGF0ZVRlc3RpbmdNb2R1bGV9IGluc3RhbmNlIHdpdGggYWRkaXRpb25hbCB0cmFuc2xhdGlvbnMuIFRoZVxyXG4gICAqIHRyYW5zbGF0aW9ucyB3aWxsIGJlIHNoYWxsb3dseSBtZXJnZWQgd2l0aCBhbnkgZXhpc3RpbmcgdHJhbnNsYXRpb25zLlxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKlxyXG4gICAqIGNvbnN0IEVOR0xJU0hfVFJBTlNMQVRJT05TID0geyBlbjogeyBncmVldGluZzogJ0hlbGxvJyB9IH07XHJcbiAgICogY29uc3QgU1BBTklTSF9UUkFOU0xBVElPTlMgPSB7IGVuOiB7IGdyZWV0aW5nOiAnSG9sYScgfSB9O1xyXG4gICAqIGNvbnN0IHRyYW5zbGF0ZU1vZHVsZSA9IFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUud2l0aFRyYW5zbGF0aW9ucyhFTkdMSVNIX1RSQU5TTEFUSU9OUylcclxuICAgKiAgIC53aXRoVHJhbnNsYXRpb25zKFNQQU5JU0hfVFJBTlNMQVRJT05TKTtcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7VHJhbnNsYXRpb25zfSB0cmFuc2xhdGlvbnMgdGhlIGFkZGl0aW9uYWwgdHJhbnNsYXRpb25zIHRvIGFkZCB0byB0aGUgdGVzdGluZyBzZXJ2aWNlLlxyXG4gICAqIEByZXR1cm5zIHRoZSBpbnN0YW5jZSB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoYWluIGFkZGl0aW9uYWwgY29uZmlndXJhdGlvbi5cclxuICAgKiBAbWVtYmVyb2YgVHJhbnNsYXRlVGVzdGluZ01vZHVsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyB3aXRoVHJhbnNsYXRpb25zKHRyYW5zbGF0aW9uczogVHJhbnNsYXRpb25zKTogVHJhbnNsYXRlVGVzdGluZ01vZHVsZTtcclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGUge1RyYW5zbGF0ZVRlc3RpbmdNb2R1bGV9IGluc3RhbmNlIHdpdGggYWRkaXRpb25hbCB0cmFuc2xhdGlvbnMgZm9yIGFcclxuICAgKiBzcGVjaWZpZWQgbGFuZ3VhZ2UuIFRoZSB0cmFuc2xhdGlvbnMgd2lsbCBiZSBzaGFsbG93bHkgbWVyZ2VkIHdpdGggYW55IGV4aXN0aW5nIHRyYW5zbGF0aW9ucy5cclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICpcclxuICAgKiBjb25zdCBFTkdMSVNIX1RSQU5TTEFUSU9OUyA9IHsgZ3JlZXRpbmc6ICdIZWxsbycgfTtcclxuICAgKiBjb25zdCBTUEFOSVNIX1RSQU5TTEFUSU9OUyA9IHsgZ3JlZXRpbmc6ICdIb2xhJyB9O1xyXG4gICAqIGNvbnN0IHRyYW5zbGF0ZU1vZHVsZSA9IFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUud2l0aFRyYW5zbGF0aW9ucygnZW4nLCBFTkdMSVNIX1RSQU5TTEFUSU9OUylcclxuICAgKiAgIC53aXRoVHJhbnNsYXRpb25zKCdlcycsIFNQQU5JU0hfVFJBTlNMQVRJT05TKTtcclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICpcclxuICAgKiBUcmFuc2xhdGVUZXN0aW5nTW9kdWxlLndpdGhUcmFuc2xhdGlvbnMoJ2VuJywgcmVxdWlyZSgnLi4vLi4vYXNzZXRzL2kxOG4vZW4uanNvbicpKVxyXG4gICAqICAgLndpdGhUcmFuc2xhdGlvbnMoJ2VzJywgcmVxdWlyZSgnLi4vLi4vYXNzZXRzL2kxOG4vZXMuanNvbicpKTtcclxuICAgKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSB0aGUgbGFuZ3VhZ2UgZm9yIHdoaWNoIHRoZSBuZXcgdHJhbnNsYXRpb25zIGFyZSBiZWluZyBhZGRlZC5cclxuICAgKiBAcGFyYW0ge0xhbmd1YWdlVHJhbnNsYXRpb25zfSB0cmFuc2xhdGlvbnMgdGhlIHRyYW5zbGF0aW9ucyBmb3IgdGhlIHNwZWNpZmllZCBsYW5ndWFnZS5cclxuICAgKiBAcmV0dXJucyB0aGUgaW5zdGFuY2UgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGFpbiBhZGRpdGlvbmFsIGNvbmZpZ3VyYXRpb24uXHJcbiAgICogQG1lbWJlcm9mIFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGVcclxuICAgKi9cclxuICBwdWJsaWMgd2l0aFRyYW5zbGF0aW9ucyhcclxuICAgIGxhbmd1YWdlOiBzdHJpbmcsXHJcbiAgICB0cmFuc2xhdGlvbnM6IExhbmd1YWdlVHJhbnNsYXRpb25zXHJcbiAgKTogVHJhbnNsYXRlVGVzdGluZ01vZHVsZTtcclxuXHJcbiAgcHVibGljIHdpdGhUcmFuc2xhdGlvbnMoXHJcbiAgICBsYW5ndWFnZU9yVHJhbnNsYXRpb25zOiBzdHJpbmcgfCBUcmFuc2xhdGlvbnMsXHJcbiAgICB0cmFuc2xhdGlvbnM/OiBMYW5ndWFnZVRyYW5zbGF0aW9uc1xyXG4gICk6IFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUge1xyXG4gICAgaWYgKHR5cGVvZiBsYW5ndWFnZU9yVHJhbnNsYXRpb25zID09PSAnc3RyaW5nJyAmJiB0cmFuc2xhdGlvbnMpIHtcclxuICAgICAgdGhpcy5hZGRUcmFuc2xhdGlvbnMobGFuZ3VhZ2VPclRyYW5zbGF0aW9ucywgdHJhbnNsYXRpb25zKTtcclxuICAgICAgdGhpcy5fZGVmYXVsdExhbmd1YWdlID0gbGFuZ3VhZ2VPclRyYW5zbGF0aW9ucztcclxuICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2VPclRyYW5zbGF0aW9ucykge1xyXG4gICAgICBPYmplY3Qua2V5cyhsYW5ndWFnZU9yVHJhbnNsYXRpb25zKS5mb3JFYWNoKGxhbmd1YWdlID0+XHJcbiAgICAgICAgdGhpcy5hZGRUcmFuc2xhdGlvbnMobGFuZ3VhZ2UsIGxhbmd1YWdlT3JUcmFuc2xhdGlvbnNbbGFuZ3VhZ2VdKVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSB7VHJhbnNsYXRpb25UZXN0aW5nTW9kdWxlfSB0byBwcm92aWRlIGEge1RyYW5zbGF0ZVNlcnZpY2V9IHRoYXQgd2lsbFxyXG4gICAqIHVzZSB0aGUgcHJvdmlkZWQge1RyYW5zbGF0ZUNvbXBpbGVyfSB0byB0cmFuc2xhdGUgdGhlIHRlc3QgdHJhbnNsYXRpb25zLlxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKlxyXG4gICAqIFRyYW5zbGF0ZVRlc3RpbmdNb2R1bGUud2l0aFRyYW5zbGF0aW9ucygnZW4nLCB7cGVvcGxlOiAne2dlbmRlciwgc2VsZWN0LCBtYWxle0hlIGlzfSBmZW1hbGV7U2hlIGlzfSBvdGhlcntUaGV5IGFyZX19IHtob3d9KSd9KVxyXG4gICAqICAgLndpdGhDb21waWxlcihuZXcgVHJhbnNsYXRlTWVzc2FnZUZvcm1hdENvbXBpbGVyKCkpO1xyXG4gICAqXHJcbiAgICogQHBhcmFtIGNvbXBpbGVyIHRoZSBjb21waWxlciB0byB1c2UgdG8gY29tcGlsZSB0aGUgdGVzdCB0cmFuc2xhdGlvbnMuXHJcbiAgICogQHJldHVybnMgdGhlIGluc3RhbmNlIHRoYXQgY2FuIGJlIHVzZWQgdG8gY2hhaW4gYWRkaXRpb25hbCBjb25maWd1cmF0aW9uLlxyXG4gICAqIEBtZW1iZXJvZiBUcmFuc2xhdGVUZXN0aW5nTW9kdWxlXHJcbiAgICovXHJcbiAgcHVibGljIHdpdGhDb21waWxlcihjb21waWxlcjogVHJhbnNsYXRlQ29tcGlsZXIpOiBUcmFuc2xhdGVUZXN0aW5nTW9kdWxlIHtcclxuICAgIHRoaXMuX2NvbXBpbGVyID0gY29tcGlsZXI7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIHtUcmFuc2xhdGVUZXN0aW5nTW9kdWxlfSB0byB1c2UgdGhlIHByb3ZpZGVkIGxhbmd1YWdlIGFzIHRoZSBkZWZhdWx0IGxhbmd1YWdlLlxyXG4gICAqIEJ5IGRlZmF1bHQsIHRoZSBkZWZhdWx0IGxhbmd1YWdlIHdpbGwgYmUgc2V0IHRvIHRoZSBmaXJzdCBsYW5ndWFnZSBwcm92aWRlZC5cclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICpcclxuICAgKiBUcmFuc2xhdGVUZXN0aW5nTW9kdWxlLndpdGhUcmFuc2xhdGlvbnMoJ2VzJywgU1BBTklTSF9UUkFOU0xBVElPTlMpXHJcbiAgICogICAud2l0aFRyYW5zbGF0aW9ucygnZW4nLCBFTkdMSVNIX1RSQU5TTEFUSU9OUylcclxuICAgKiAgIC53aXRoRGVmYXVsdExhbmd1YWdlKCdlbicpO1xyXG4gICAqXHJcbiAgICogQHBhcmFtIGxhbmd1YWdlIHRoZSBuZXcgZGVmYXVsdCBsYW5ndWFnZSBmb3IgdHJhbnNsYXRpb25zLlxyXG4gICAqIEByZXR1cm5zIHRoZSBpbnN0YW5jZSB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoYWluIGFkZGl0aW9uYWwgY29uZmlndXJhdGlvbi5cclxuICAgKiBAbWVtYmVyb2YgVHJhbnNsYXRlVGVzdGluZ01vZHVsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyB3aXRoRGVmYXVsdExhbmd1YWdlKGxhbmd1YWdlOiBzdHJpbmcpOiBUcmFuc2xhdGVUZXN0aW5nTW9kdWxlIHtcclxuICAgIHRoaXMuX2RlZmF1bHRMYW5ndWFnZSA9IGxhbmd1YWdlIHx8IHRoaXMuX2RlZmF1bHRMYW5ndWFnZTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhZGRUcmFuc2xhdGlvbnMobGFuZ3VhZ2U6IHN0cmluZywgdHJhbnNsYXRpb25zOiBMYW5ndWFnZVRyYW5zbGF0aW9ucykge1xyXG4gICAgaWYgKCF0aGlzLl9kZWZhdWx0TGFuZ3VhZ2UpIHtcclxuICAgICAgdGhpcy5fZGVmYXVsdExhbmd1YWdlID0gbGFuZ3VhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX3RyYW5zbGF0aW9uc1tsYW5ndWFnZV0pIHtcclxuICAgICAgdGhpcy5fdHJhbnNsYXRpb25zW2xhbmd1YWdlXSA9IHtcclxuICAgICAgICAuLi50aGlzLl90cmFuc2xhdGlvbnNbbGFuZ3VhZ2VdLFxyXG4gICAgICAgIC4uLnRyYW5zbGF0aW9uc1xyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fdHJhbnNsYXRpb25zW2xhbmd1YWdlXSA9IHRyYW5zbGF0aW9ucztcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19